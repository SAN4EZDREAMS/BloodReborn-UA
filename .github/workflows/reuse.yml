name: Check Unique XML IDs

on:
    workflow_call:

jobs:
  check-xml-ids:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Scan XML files for duplicate IDs
        run: |
          ids=$(grep -ohr '<text id="[0-9]\+"' --include "*.xml" . | sed -E 's/<text id="([0-9]+)"/\1/' | sort)
          duplicates=$(echo "$ids" | uniq -d)
          
          if [ -n "$duplicates" ]; then
            echo "Error: Duplicate IDs found in XML files!"
            grep -rn '<text id="'"$duplicates"'"' --include "*.xml"
            exit 1
          else
            echo "All XML IDs are unique."
          fi
